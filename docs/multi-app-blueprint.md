## Multi-app blueprint (Silexa)

This blueprint standardizes how we build and operate many web apps (SaaS, blogs,
marketing sites, internal tools) while keeping Silexa routing, dyads, and
monitoring consistent.

### Goals
- Keep app structure predictable across teams and dyads.
- Make capabilities explicit (auth, billing, CMS, analytics).
- Keep infra and maintenance consistent so agents can operate safely.

### Canonical app layout (SvelteKit-first)
```
apps/<app>/
  web/                 # SvelteKit (TypeScript) app
  backend/             # optional Go service
  infra/               # Pulumi (or other IaC)
  content/             # optional blog/marketing content
  docs/
    plan.md            # generated by bin/start-app-project.sh
  migrations/          # per-app DB migrations
  ui-tests/
    targets.json       # visual test targets
  app.json             # app metadata (capabilities, owners, paths)
```

If an existing app uses a different layout, capture it in `app.json` under `paths`
instead of moving folders.

### App metadata (apps/<app>/app.json)
This file is the source of truth for capabilities, owners, and stack choices.
Agents should read it before starting work.

Example (SvelteKit + Go backend):
```json
{
  "name": "acme-billing",
  "kind": "saas",
  "stack": {
    "web": "sveltekit",
    "backend": "go",
    "language": "typescript",
    "ui": "shadcn-svelte",
    "runtime": "node"
  },
  "paths": {
    "web": "web",
    "backend": "backend",
    "infra": "infra",
    "content": ""
  },
  "modules": ["auth", "billing", "analytics"],
  "owners": {
    "department": "web",
    "dyad": "web-acme"
  },
  "data": {
    "db": "postgres",
    "orm": "drizzle",
    "cache": ""
  },
  "integrations": ["stripe", "postmark"],
  "status": "idea"
}
```

### Capability modules
Keep reusable capability modules in one place so apps can opt in quickly.

Suggested structure:
```
packages/<module>/
  README.md            # install steps + required env vars
  src/                 # shared implementation (if applicable)
```

Common modules: auth, billing, CMS, analytics, email, search, notifications.

Current shared packages:
- `@silexa/ui` (shadcn-svelte components)
- `@silexa/db` (Drizzle + Postgres helper)
- `@silexa/auth` (@auth/sveltekit adapters)

### Standard web stack
- SvelteKit (TypeScript) full-stack app per project.
- UI: shadcn-svelte + Tailwind.
- Auth: `@auth/sveltekit` (+ Drizzle adapter).
- DB/ORM: Postgres + Drizzle.
- Validation: Zod; forms via `sveltekit-superforms` when needed.
See `docs/web-stack.md` for the default library list.

### Silexa integration (per app)
1) Bootstrap the app:
   - `bin/start-app-project.sh <app>`
   - Fill `apps/<app>/app.json` and `apps/<app>/docs/plan.md`.
   - Existing apps: `bin/adopt-app.sh <app> --web-path <path> [--backend-path <path>]`.
2) Register dyads:
   - `bin/dyadctl.sh register <app> <role> <department>`
3) Route tasks:
   - Add app keywords to `configs/router_rules.json` as needed.
4) Provision DB:
   - `bin/app-db.sh create <app>` and use `secrets/db-<app>.env`.
5) Document CI/deploy in `apps/<app>/infra/` and update plan.

### Monorepo management
- JS workspace via `pnpm-workspace.yaml` (apps, packages, tools).
- Shared packages live under `packages/`; avoid copy/paste across apps.

### Deployment
- Each app deploys as its own Swarm stack: `bin/app-deploy.sh <app>`.
- See `docs/app-deploy.md` for build/secrets/port overrides.
 - Validate app structure: `bin/app-audit.sh` (use `--strict` to enforce warnings).
 - Check live stack health: `bin/app-status.sh <app>`.

### Lifecycle references
- `docs/app-lifecycle.md` for intake → build → operate.
- `docs/web_app_flow.md` for dyad responsibilities and QA.

### Maintenance cadence
- Weekly: health checks, broken links, and perf/regression review.
- Monthly: module updates and dependency refresh.
- Quarterly: access and secrets audit, cost review.
